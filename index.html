<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>北斗 転生の章2 AI期待値ツール</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
  background:#f4f6fb;
  margin:0;
  padding:10px;
}
.box{
  background:#fff;
  border-radius:12px;
  padding:14px;
  max-width:480px;
  margin:auto;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
h1{
  font-size:18px;
  text-align:center;
  margin-bottom:12px;
}
label{
  font-size:14px;
  font-weight:bold;
}
input,select,button{
  width:100%;
  padding:10px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-bottom:10px;
  box-sizing:border-box;
}
button{
  background:#007aff;
  color:#fff;
  border:none;
  font-weight:bold;
}
.result{
  background:#f1f3f7;
  padding:12px;
  border-radius:10px;
  margin-top:12px;
  font-size:14px;
  line-height:1.6;
}
.good{color:#d60000;font-weight:bold;font-size:16px;}
</style>
</head>

<body>
<div class="box">
<h1>北斗 転生の章2<br>AI期待値 × モード推測</h1>

<label>現在あべし</label>
<input id="abeshi" type="number" value="0" min="0" max="1536">

<label>枠ランプ示唆</label>
<select id="lamp">
  <option value="none">なし</option>
  <option value="yellow">黄緑（B以上）</option>
  <option value="yellow_blink">黄緑点滅（C以上）</option>
  <option value="gold">金（B以上強）</option>
  <option value="gold_blink">金点滅（C以上強）</option>
  <option value="purple">紫（B以上＋設定示唆）</option>
</select>

<label>換金率</label>
<select id="rate">
  <option value="5">5.0枚</option>
  <option value="5.6">5.6枚</option>
  <option value="6">6.0枚</option>
</select>

<button onclick="calc()">期待値計算</button>

<div id="result" class="result"></div>
</div>

<script>
function calc(){

  let abeshi = Number(document.getElementById("abeshi").value);
  let lamp = document.getElementById("lamp").value;
  let rate = Number(document.getElementById("rate").value);

  // ---- 投資 & 時間（てんぱ補正込み）
  const yenPerAbeshi = 19.5;
  const abeshiPerMin = 26;

  let remain = Math.max(0,1536-abeshi);
  let invest = remain * yenPerAbeshi;
  let time = remain / abeshiPerMin;

  // ---- モード初期分布
  let mode = {A:0.50, B:0.27, C:0.17, T:0.06};

  // ---- ランプ示唆補正
  if(lamp=="yellow") mode={A:0.05,B:0.55,C:0.30,T:0.10};
  if(lamp=="yellow_blink") mode={A:0.01,B:0.20,C:0.60,T:0.19};
  if(lamp=="gold") mode={A:0.01,B:0.60,C:0.30,T:0.09};
  if(lamp=="gold_blink") mode={A:0.00,B:0.15,C:0.65,T:0.20};
  if(lamp=="purple") mode={A:0.00,B:0.55,C:0.35,T:0.10};

  // ---- 天国否定補正
  if(abeshi > 128) mode.T = 0;

  // ---- 深さ補正
  if(abeshi>=350) mode.A*=0.75;
  if(abeshi>=550) mode.A*=0.55;
  if(abeshi>=750) mode.A*=0.40;
  if(abeshi>=900) mode.A*=0.25;

  // ---- 正規化
  let total = mode.A+mode.B+mode.C+mode.T;
  for(let k in mode){ mode[k]/=total; }

  // ---- ゾーン当選率
  const zoneRate = {
    T: {128:0.70},
    C: {256:0.32, 448:0.18, 576:0.45},
    B: {256:0.18, 448:0.14, 896:0.52},
    A: {256:0.12, 448:0.08, 576:0.08, 896:0.06, 1152:0.06, 1536:0.60}
  };

  // ---- 平均獲得
  const pay = {A:520, B:610, C:720, T:850, TEN:650};

  function zoneEV(m, zone, rate, p){
    if(abeshi >= zone) return 0;
    return m * rate * p;
  }

  let ev =
    zoneEV(mode.T,128,0.70,pay.T) +

    zoneEV(mode.C,256,0.32,pay.C) +
    zoneEV(mode.C,448,0.18,pay.C) +
    zoneEV(mode.C,576,0.45,pay.C) +

    zoneEV(mode.B,256,0.18,pay.B) +
    zoneEV(mode.B,448,0.14,pay.B) +
    zoneEV(mode.B,896,0.52,pay.B) +

    zoneEV(mode.A,256,0.12,pay.A) +
    zoneEV(mode.A,448,0.08,pay.A) +
    zoneEV(mode.A,576,0.08,pay.A) +
    zoneEV(mode.A,896,0.06,pay.A) +
    zoneEV(mode.A,1152,0.06,pay.A) +
    zoneEV(mode.A,1536,0.60,pay.TEN);

  let evYen = ev*(50/rate) - invest;
  let hourly = evYen/(time/60);

  let stop="";
  if(mode.T>0.18) stop="天国期待 → 128まで";
  else if(mode.C>0.45) stop="C濃厚 → 576まで";
  else if(mode.B>0.45) stop="B濃厚 → 896まで";
  else stop="示唆弱 → 即ヤメ";

  document.getElementById("result").innerHTML=`
  【モード期待度】<br>
  A:${(mode.A*100).toFixed(1)}% / B:${(mode.B*100).toFixed(1)}% / 
  C:${(mode.C*100).toFixed(1)}% / 天国:${(mode.T*100).toFixed(1)}%<br><br>

  天井まで：${remain}あべし（約${Math.round(time)}分）<br>
  平均投資：約${Math.round(invest)}円<br>

  <span class="good">期待値：${Math.round(evYen)}円</span><br>
  時給：${Math.round(hourly)}円/h<br><br>

  【AIヤメ時】${stop}
  `;
}
</script>
</body>
</html>