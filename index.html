import { useState } from "react";

const MODE_CEILING = {
  A: 1536,
  B: 1280,
  C: 1024,
  T: 256,
};

const ZONES = {
  A: [256, 512, 768, 1024, 1280, 1536],
  B: [192, 384, 640, 896, 1280],
  C: [128, 256, 512, 768, 1024],
  T: [64, 128, 192, 256],
};

const TENPA_CORRECTION = 1.085;

export default function App() {
  const [abeshi, setAbeshi] = useState(0);
  const [mode, setMode] = useState("A");
  const [rate, setRate] = useState(20);

  const calcInvestment = (g) =>
    Math.round(g * (50 / 31.5) * rate);

  const calcTime = (g) =>
    Math.round((g / 800) * 60);

  const calcEV = () => {
    const corr = abeshi * TENPA_CORRECTION;
    const ceiling = MODE_CEILING[mode];
    const remain = ceiling - corr;

    if (remain <= 0) return 0;

    const avgPay = 620;
    const invest = calcInvestment(remain);
    const returnYen = avgPay * rate;

    return Math.round(returnYen - invest);
  };

  const remainGame = Math.max(
    0,
    MODE_CEILING[mode] - abeshi * TENPA_CORRECTION
  );

  return (
    <div style={{ padding: 20, maxWidth: 480, margin: "auto" }}>
      <h2>北斗 転生の章2 期待値ツール（補正版）</h2>

      <label>現在あべし</label>
      <input
        type="number"
        value={abeshi}
        onChange={(e) => setAbeshi(+e.target.value)}
        style={{ width: "100%" }}
      />

      <label>モード</label>
      <select
        value={mode}
        onChange={(e) => setMode(e.target.value)}
        style={{ width: "100%" }}
      >
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="T">天国</option>
      </select>

      <label>換金率</label>
      <select
        value={rate}
        onChange={(e) => setRate(+e.target.value)}
        style={{ width: "100%" }}
      >
        <option value={20}>等価</option>
        <option value={17.86}>5.6枚</option>
      </select>

      <hr />

      <p>残りあべし（補正後）：{Math.round(remainGame)}</p>
      <p>天井までの時間：約{calcTime(remainGame)}分</p>
      <p>平均投資額：約{calcInvestment(remainGame)}円</p>

      <h3>期待値：{calcEV()} 円</h3>
    </div>
  );
}